import sqlite3
import generator
import datetime

##dont import these test records because the have too many fields!
bad_test_ids = ["233955117","386678619","1359254837","904428237","375221213","869423849",
                "48161533","717210263","1367151955","1323335281","180667909","1895398527",
                "428819387","464171487","1601052771","1621217083","922126169","265628575",
                "1988810703","1689477937","1342210385","1679058489","1130924309","1073468729",
                "645260615","1317388513","587943107","1386423595","516327099","35282963",
                "427980805","170411965","1690480313","1836114963","60634693","1028516379",
                "1673922741","415311651","1740566237","1890162553","1856185457","212521249",
                "1055051825","43065871","1048605045","1128471909","1101113589","1506382555",
                "1079544561","1200554117","932660565","759179459","1094795963","1937517693",
                "226149467","1181273671","287048171","1655219499","1281827333","1668277235",
                "702460957","599379541","764101713","497950147","1688816147","1072508545",
                "518347783","770382435","1009282159","66302965","464448617","363530147",
                "386813847","1090290367","1297893363","872011811","1600199065","611260731",
                "448697539","733479435","550676061","1194371157","211544529","767307323",
                "1173142491","902571103","377513067","16262169","1737733143","1966123253",
                "1855919845","659952201","1257569781","1534770185","203199429","1647427897",
                "1533186907","1403856227","1909146757","951272297","563642533","49277445",
                "1558643883","1239661583","1183364937","202023287","776210065","249623559",
                "1223293193","436258639","1724195875","1464820225","819190443","1664741637",
                "1462726965","919731871","1947247813","1841683681","1224156691","1995016877",
                "586255951","150257445","387565377","757903225","180348095","1519908507",
                "522650483","1806278341","691680823","135528663","160820051","228469777",
                "1102517745","1131567949","537766435","619768057","1318206771","1936266375",
                "1105641861","1965379229","617085919","50750525","1703578001","1418784431",
                "1299891573","1419359215","758745705","1869009399","467308801","405622693",
                "676675809","1327670965","1393234825","1385659607","1867455385","165142403",
                "824693867","1241716639","1470051987","44506371","577457625","393279493",
                "893366673","581959367","864845969","1924792925","641791297","948451505",
                "317219755","1669022379","852020705","1018102645","1384560231","470021121",
                "1709979967","1723885023","1953933003","915921877","296537169","1505445719",
                "1556077163","986969129","494335923","1372965581","39412973","931032317",
                "225150631","516583345","1984832209","1779902971","1449825473","1024646111",
                "718883303","450272033","870633513","1926667605","1662798459","350240969",
                "1913146291","1785800287","976210753","924390193","568325391","365867307",
                "1083896647","228548157","1945792883","491677559","1217864721","815152615",
                "116498077","787591535","794885523","290732461","1716027163","1732288851",
                "1098644967","1745732973","1949606193","1596790493","833697373","173544909",
                "317432621","1890663999","1157295601","235864619","204386865","1183289179",
                "510265181","441099533","1477642307","35000523","902654681","571897803",
                "1001495979","921969253","562056791","1746568619","1510431609","1726995941",
                "1544639407","509606371","23712109","950189099","599292557","494161193",
                "703484799","1540874205","1487519237","1965260517","951370709","645598871",
                "820554827","1554962909","1586639189","581762231","772135423","799362751",
                "1324933907","803376581","1695999825","774045147","718567297","1225926663",
                "1968124241","847687105","1860701293","1825339087","430474411","644895269",
                "1433606627","469016235","511529831","10853213","541188407","136285123",
                "309085617","538895523","843764763","1672883259","1865255221","1311012315",
                "75448845","855917481","710544455","1662417025","900302665","1474418525",
                "313454889","198990771","331750033","1530291231","1232126653","917126253",
                "269009789"]

def importr():

    for r in generator.dGenerateCars():

        #c.execute("""INSERT INTO MOT (test_id, vehicle_id, test_date,test_class_id,test_type,test_result,test_mileage,postcode_area,make,model,colour,fuel_type,cylinder_capacity,first_use_date)
        #          values("""+r[0]+""","""+r[1]+""", date("""+r[2]+"""),"""+r[3]+""","""+r[4]+""","""+r[5]+""","""+r[6]+""","""+r[7]+""","""+r[8]+""","""+r[9]+""","""+r[10]+""","""+r[11]+""","""+r[12]+""",date("""+r[13]+"""))""")
        if r[0]=="test_id": #dont do headers
            continue

        ##about 200 records contain too many field, so ignore them
        if len(r)!=14:
            continue

        #try:
        #    datetime.datetime.strptime(r[13], '%Y-%m-%d')
        #except ValueError:
        #    r[13]=""      

        try:
            c.execute("""INSERT INTO MOT (test_id, vehicle_id, test_date,test_class_id,test_type,test_result,test_mileage,postcode_area,make,model,colour,fuel_type,cylinder_capacity,first_use_date)
                      values("""+r[0]+""","""+r[1]+""","""+"'"+r[2]+"'"+""","""+r[3]+""","""+"'"+r[4]+"'"+""","""+"'"+r[5]+"'"+""","""+"'"+r[6]+"'"+""","""+"'"+r[7]+"'"+""","""+"'"+r[8].translate(str.maketrans({"'":  r"''"}))+"'"+""","""+"'"+r[9].translate(str.maketrans({"'":  r"''"}))+"'"+""","""+"'"+r[10]+"'"+""","""+"'"+r[11]+"'"+""","""+"'"+r[12]+"'"+""","""+"'"+r[13]+"'"+""")""")
        except Exception as e:
            print(r)
            print(r[4])
            print(r[13])
            print(len(r))
            raise e
            break



    conn.commit() #commit needed
    c.close()

def createTable():
    c.execute("""CREATE TABLE MOT
                 (test_id,vehicle_id, test_date,test_class_id,test_type,test_result,test_mileage,postcode_area,make,model,colour,fuel_type,cylinder_capacity,first_use_date)""")

db_path = 'the.db'
conn = sqlite3.connect(db_path)
c = conn.cursor()



#for row in c.execute("""SELECT vehicle_id,test_date,test_mileage FROM MOT WHERE vehicle_id=591469624"""):
#    print(row)

#createTable()
importr()



#use date function for import
#createTable()
#does table exist?
#createTable()




